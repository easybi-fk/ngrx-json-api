!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("lodash"),require("rxjs/add/observable/concat"),require("rxjs/add/observable/throw"),require("rxjs/add/operator/combineLatest"),require("rxjs/add/operator/concat"),require("rxjs/add/operator/concatMap"),require("rxjs/add/operator/distinctUntilChanged"),require("rxjs/add/operator/do"),require("rxjs/add/operator/filter"),require("rxjs/add/operator/let"),require("rxjs/add/operator/map"),require("rxjs/add/operator/mergeMap"),require("rxjs/add/observable/zip"),require("rxjs/operators"),require("@ngrx/store"),require("rxjs/add/operator/finally"),require("@angular/core"),require("@angular/common/http"),require("rxjs/Observable"),require("@ngrx/effects"),require("rxjs/observable/of"),require("rxjs/add/operator/concatAll")):"function"==typeof define&&define.amd?define(["exports","lodash","rxjs/add/observable/concat","rxjs/add/observable/throw","rxjs/add/operator/combineLatest","rxjs/add/operator/concat","rxjs/add/operator/concatMap","rxjs/add/operator/distinctUntilChanged","rxjs/add/operator/do","rxjs/add/operator/filter","rxjs/add/operator/let","rxjs/add/operator/map","rxjs/add/operator/mergeMap","rxjs/add/observable/zip","rxjs/operators","@ngrx/store","rxjs/add/operator/finally","@angular/core","@angular/common/http","rxjs/Observable","@ngrx/effects","rxjs/observable/of","rxjs/add/operator/concatAll"],t):t((e.ngrx=e.ngrx||{},e.ngrx.json=e.ngrx.json||{},e.ngrx.json.api={}),e.lodash,null,null,null,null,null,null,null,null,null,null,null,null,e.operators,e.store,null,e.ng.core,e.http,e.Rx,e.effects,e.Rx.Observable)}(this,function(e,t,r,n,o,i,a,s,u,p,c,d,f,l,y,h,v,E,A,I,g,_){"use strict";function P(e,r,n){return n===t.get(e,r)?e:t.setWith(t.clone(e),r,n,function(e,r,n){var o=t.clone(n);return o[r]=e,o})}function S(e,t,r){var n=e[t][r];n.persistedResource?"IN_SYNC"!==n.state&&(e[t][r]=H({},e[t][r],{state:"IN_SYNC",resource:e[t][r].persistedResource})):delete e[t][r]}function R(e,r,n,o,i){var a=e[n.type][n.id];"IN_SYNC"===a.state||"NEW"===a.state&&!i||r.push(a);for(var s=0,u=o;s<u.length;s++){var p=u[s];!function(n){if(n.length>0){var s=n[0];if(a.relationships&&a.relationships[s]){var u=a.relationships[s].data;if(u){var p=[];if(o.filter(function(e){return e.length>=2&&e[0]==s}).forEach(function(e){return p.push(e.slice(1))}),t.isArray(u)){u.forEach(function(t){return R(e,r,t,p,i)})}else{R(e,r,u,p,i)}}}}}(p)}}function O(e,r,n,o){var i=[];if(t.isUndefined(r))Object.keys(e).forEach(function(t){Object.keys(e[t]).forEach(function(r){var n=e[t][r];"IN_SYNC"===n.state||"NEW"===n.state&&!o||i.push(n)})});else{var a=[];if(n)for(var s=0,u=n;s<u.length;s++){var p=u[s];a.push(p.split("."))}for(var c=0,d=r;c<d.length;c++){var f=d[c];R(e,i,f,a,o)}i=t.uniqBy(i,function(e){return e.type+"####"+e.id})}return i}function T(){return function(e){return e.pipe(h.select("NgrxJsonApi"),y.map(function(e){return e}),y.filter(function(e){return!t.isUndefined(e)}))}}function m(){return C(M)}function C(e){return function(t){return t.let(T()).map(function(t){return t.zones[e]})}}function q(e,t){return e.NgrxJsonApi.zones[t]}function w(e){return function(t){return t.map(function(t){return t.queries[e]})}}function L(e){return function(t){return t.map(function(e){return e.data}).map(function(t){return t?t[e]:void 0})}}function U(e){return function(t){return t.let(L(e.type)).map(function(t){return t?t[e.id]:void 0})}}function D(e){return function(t){return t.pipe(y.map(function(e){return e.data}),y.map(function(t){return e.map(function(e){if(t&&t[e.type])return t[e.type][e.id]})}))}}function b(e,r){return function(n){return n.map(function(n){var o=n.queries[e];if(o){if(t.isEmpty(o.resultIds)){return Ne({},o,{data:t.isUndefined(o.resultIds)?void 0:[]})}var i=o.resultIds.map(function(e){return n.data[e.type]?n.data[e.type][e.id]:void 0});return r&&(i=k(i,n.data)),Ne({},o,{data:i})}})}}function j(e,r){return function(n){return n.map(function(n){var o=n.queries[e];if(o){if(t.isEmpty(o.resultIds)){var i=Ne({},o,{data:t.isUndefined(o.resultIds)?void 0:null});return i}if(o.resultIds.length>=2)throw new Error("expected single result for query "+o.query.queryId);var a=o.resultIds[0],s=n.data[a.type]?n.data[a.type][a.id]:void 0;r&&(s=W(s,n.data));var i=Ne({},o,{data:s});return i}})}}function N(e){return e.let(m())}function x(e,t){void 0===e&&(e=Lt);var r,n=t.zoneId;if(!n)return e;var o=e.zones[n];o||(o=wt);var i=z(o,t);return o!=i?qt({},e,{zones:qt({},e.zones,(r={},r[n]=i,r))}):e}function z(e,t){var r;switch(t.type){case Fe.API_POST_INIT:var n=de(e.data,t.payload,!1,!0);return r=qt({},e,{data:n,isCreating:e.isCreating+1});case Fe.API_GET_INIT:var o=t.payload;return r=qt({},e,{queries:le(e.queries,o),isReading:e.isReading+1});case Fe.API_PATCH_INIT:var n=de(e.data,t.payload,!1,!1);return r=qt({},e,{data:n,isUpdating:e.isUpdating+1});case Fe.API_DELETE_INIT:return r=qt({},e,{data:re(e.data,t.payload,"DELETED"),isDeleting:e.isDeleting+1});case Fe.API_POST_SUCCESS:return r=qt({},e,{data:fe(e.data,t.payload.jsonApiData),isCreating:e.isCreating-1});case Fe.API_GET_SUCCESS:return r=qt({},e,{data:fe(e.data,t.payload.jsonApiData),queries:ye(e.queries,t.payload.query.queryId,t.payload.jsonApiData),isReading:e.isReading-1});case Fe.API_PATCH_SUCCESS:return r=qt({},e,{data:fe(e.data,t.payload.jsonApiData),isUpdating:e.isUpdating-1});case Fe.API_DELETE_SUCCESS:return r=qt({},e,{data:pe(e.data,t.payload.query),queries:ie(e.queries,{id:t.payload.query.id,type:t.payload.query.type}),isDeleting:e.isDeleting-1});case Fe.API_QUERY_REFRESH:return r=qt({},e,{queries:ce(e.queries,t.payload)});case Fe.API_POST_FAIL:return r=qt({},e,{data:ae(e.data,t.payload.query,t.payload.jsonApiData),isCreating:e.isCreating-1});case Fe.API_GET_FAIL:return r=qt({},e,{queries:he(e.queries,t.payload.query.queryId,t.payload.jsonApiData),isReading:e.isReading-1});case Fe.API_PATCH_FAIL:return r=qt({},e,{data:ae(e.data,t.payload.query,t.payload.jsonApiData),isUpdating:e.isUpdating-1});case Fe.API_DELETE_FAIL:return r=qt({},e,{data:ae(e.data,t.payload.query,t.payload.jsonApiData),isDeleting:e.isDeleting-1});case Fe.REMOVE_QUERY:var i=t.payload;return r=qt({},e,{queries:ve(e.queries,i)});case Fe.LOCAL_QUERY_INIT:var o=t.payload;return r=qt({},e,{queries:le(e.queries,o)});case Fe.MODIFY_STORE_RESOURCE_ERRORS:var a=t.payload;return r=qt({},e,{data:se(e.data,a.resourceId,a.errors,a.modificationType)});case Fe.LOCAL_QUERY_SUCCESS:return P(e,"queries",ye(e.queries,t.payload.query.queryId,t.payload.jsonApiData));case Fe.PATCH_STORE_RESOURCE:var n=de(e.data,t.payload,!1,!1);return n!==e.data?r=qt({},e,{data:n}):e;case Fe.POST_STORE_RESOURCE:var n=de(e.data,t.payload,!1,!0);return n!==e.data?r=qt({},e,{data:n}):e;case Fe.NEW_STORE_RESOURCE:var n=de(e.data,t.payload,!1,!0);return n=re(n,t.payload,"NEW"),n!==e.data?r=qt({},e,{data:n}):e;case Fe.DELETE_STORE_RESOURCE:var s=t.payload;if(e.data[s.type]&&e.data[s.type][s.id]){var u=e.data[s.type][s.id];return r="NEW"===u.state||"CREATED"===u.state?qt({},e,{data:te(e.data,s)}):qt({},e,{data:re(e.data,t.payload,"DELETED")})}return e;case Fe.API_APPLY_INIT:var a=t.payload,p=O(e.data,a.ids,a.include);r=qt({},e,{isApplying:e.isApplying+1});for(var c=0,d=p;c<d.length;c++){var f=d[c];if("CREATED"===f.state)r.isCreating++;else if("UPDATED"===f.state)r.isUpdating++;else{if("DELETED"!==f.state)throw new Error("unknown state "+f.state);r.isDeleting++}}return r;case Fe.API_APPLY_SUCCESS:case Fe.API_APPLY_FAIL:var l=t.payload;r=e;for(var y=0,h=l;y<h.length;y++){r=z(r,h[y])}return r=qt({},r,{isApplying:e.isApplying-1});case Fe.API_ROLLBACK:var a=t.payload;return r=qt({},e,{data:ue(e.data,a.ids,a.include)});case Fe.CLEAR_STORE:return wt;case Fe.COMPACT_STORE:return De(e);default:return e}}function F(e,t){return new Ot(e,t)}function Q(){return new xe}function J(e,t){return new At(e,t)}function Y(e){return[{provide:Ot,useFactory:F,deps:[A.HttpClient,Dt]},{provide:xe,useFactory:Q},{provide:At,useFactory:J,deps:[h.Store,Dt]},{provide:Dt,useValue:e}]}var M="default",$={ASC:0,DESC:1};$[$.ASC]="ASC",$[$.DESC]="DESC";var H=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},G=function(e,r,n,o){return void 0===o&&(o=!1),e.hasOwnProperty("relationships")&&Object.keys(e.relationships).forEach(function(i){var a=e.relationships[i],s=a.data;if(!t.isUndefined(s)){var u=void 0;if(null===s)u=s;else if(t.isArray(s))if(0==s.length)u=s;else{var p=V(s,r);u=p.map(function(e){return W(e,r,n,o)})}else{var c=B(s,r);u=W(c,r,n,o)}var d=H({},a);d.reference=u,e.relationships[i]=d}}),e},k=function(e,t,r,n){void 0===r&&(r={}),void 0===n&&(n=!1);for(var o=[],i=0,a=e;i<a.length;i++){var s=a[i];o.push(W(s,t,r,n))}return o},W=function(e,r,n,o){if(void 0===n&&(n={}),void 0===o&&(o=!1),!e)return null;if(t.isUndefined(n[e.type])&&(n[e.type]={}),t.isUndefined(n[e.type][e.id])){var i=H({},e);e.relationships&&(i.relationships=H({},e.relationships)),n[i.type][i.id]=i,i=G(i,r,n,o),i.persistedResource&&o&&(i.persistedResource=G(i.persistedResource,r,n,o))}return n[e.type][e.id]},B=function(e,r){return t.get(r,[e.type,e.id],null)},V=function(e,t){return e.map(function(e){return B(e,t)})},Z=function(e,r,n,o){var i=[];t.isUndefined(o)&&(o=".");for(var a=e.split(o),s=r,u=0;u<a.length;u++){var p=t.find(n,{type:s});if(t.isUndefined(p))throw new Error("Definition not found");if(t.isUndefined(p.attributes)&&t.isUndefined(p.relationships))throw new Error("Attributes or Relationships must be provided");if(p.attributes.hasOwnProperty(a[u])){i.push("attributes",a[u]);break}if(!p.relationships.hasOwnProperty(a[u]))throw new Error("Cannot find field in attributes or relationships");var c=p.relationships[a[u]];if("hasMany"===c.relationType){if(u!==a.length-1)throw new Error("Cannot filter past a hasMany relation");i.push("relationships",a[u],"reference")}else s=c.type,i.push("relationships",a[u],"reference")}return i.join(o)},K=function(e,r,n,o){var i=Z(e,r.type,n,o);return t.get(r,i)},X=function(e,r){function n(e,r){if(t.isArray(e))return r}return t.mergeWith({},e,r,n)},ee=function(e,r,n){var o=H({},e);return o[r.id]=n?H({},r,{persistedResource:r,state:"IN_SYNC",errors:[],loading:!1}):H({},r,{persistedResource:null,state:"CREATED",errors:[],loading:!1}),t.isEqual(e,o)?e:o},te=function(e,t){if(e[t.type][t.id]){var r=H({},e);return r[t.type]=H({},r[t.type]),delete r[t.type][t.id],r}return e},re=function(e,r,n,o){if(t.isUndefined(e[r.type])||t.isUndefined(e[r.type][r.id])){if("DELETED"===n){var i=H({},e);return i[r.type]=H({},i[r.type]),i[r.type][r.id]=H({},i[r.type][r.id]),i[r.type][r.id]={type:r.type,id:r.id,persistedResource:null},i[r.type][r.id].state="NOT_LOADED",i}return e}var a=H({},e);return a[r.type]=H({},a[r.type]),a[r.type][r.id]=H({},a[r.type][r.id]),null!==n&&(a[r.type][r.id].state=n),null!=o&&(a[r.type][r.id].loading=o),a},ne=function(e,r){return e===r||null!==e==(null!==r)&&(t.isEqual(e.id,r.id)&&t.isEqual(e.type,r.type)&&t.isEqual(e.attributes,r.attributes)&&t.isEqual(e.meta,r.meta)&&t.isEqual(e.links,r.links)&&t.isEqual(e.relationships,r.relationships))},oe=function(e,r,n){var o,i,a=e[r.id],s=e[r.id].persistedResource;if(n)o=r,s=r,i="IN_SYNC";else{var u=X(a,r);ne(u,s)?(o=s,i="IN_SYNC"):(o=u,i=null!==s?"UPDATED":"NEW"===a.state?"NEW":"CREATED")}var p=H({},e);return p[r.id]=H({},o,{persistedResource:s,state:i,errors:[],loading:!1}),t.isEqual(p[r.id],e[r.id])?e:p},ie=function(e,t){var r=e;for(var n in e)if(e.hasOwnProperty(n)){var o=e[n];if(o.query.id===t.id&&o.query.type===t.type){r=ce(r,o.query.queryId);var i={code:"404",status:"Not Found"};r[o.query.queryId].errors=[i]}}return r},ae=function(e,t,r){if(!t.type||!t.id||r.data instanceof Array)throw new Error("invalid parameters");return se(e,{id:t.id,type:t.type},r.errors,"SET")},se=function(e,r,n,o){var i,a,s;if(!e[r.type]||!e[r.type][r.id])return e;var u=H({},e);u[r.type]=H({},u[r.type]);var p=H({},u[r.type][r.id]);if("SET"===o)p.errors=[],n&&(i=p.errors).push.apply(i,n);else if("ADD"===o){var c=p.errors;p.errors=[],c&&(a=p.errors).push.apply(a,c),n&&(s=p.errors).push.apply(s,n)}else{var c=p.errors;if(p.errors=[],c)for(var d=0,f=c;d<f.length;d++){var l=f[d];!function(e){n&&n.filter(function(r){return t.isEqual(r,e)}).length>0||p.errors.push(e)}(l)}}return u[r.type][r.id]=p,u},ue=function(e,r,n){var o=H({},e);if(t.isUndefined(r))Object.keys(o).forEach(function(e){o[e]=H({},o[e]),Object.keys(o[e]).forEach(function(t){S(o,e,t)})});else for(var i=O(o,r,n,!0),a=0,s=i;a<s.length;a++){var u=s[a];S(o,u.type,u.id)}return o},pe=function(e,r){var n=H({},e);return void 0===r.id?n[r.type]={}:n[r.type]=t.omit(n[r.type],[r.id]),n},ce=function(e,t){var r=H({},e[t]);delete r.resultIds,delete r.errors,delete r.meta,delete r.links;var n=H({},e);return n[t]=r,n},de=function(e,r,n,o){if(t.isUndefined(e[r.type])){var i=H({},e);return i[r.type]={},i[r.type]=ee(i[r.type],r,n),i}if(t.isUndefined(e[r.type][r.id])||o){var a=ee(e[r.type],r,n);if(a!==e[r.type]){var i=H({},e);return i[r.type]=a,i}return e}var a=oe(e[r.type],r,n);if(a!==e[r.type]){var i=H({},e);return i[r.type]=a,i}return e},fe=function(e,r){var n=t.get(r,"data");if(t.isUndefined(n))return e;var o=t.isArray(n)?n:[n],i=t.get(r,"included");t.isUndefined(i)||(o=o.concat(i));for(var a=H({},e),s=!1,u=0,p=o;u<p.length;u++){var c=p[u],d=H({},c,{persistedResource:c,state:"IN_SYNC",errors:[],loading:!1});t.isEqual(d,c)||(s=!0,a[c.type]?a[c.type]===e[c.type]&&(a[c.type]=H({},e[c.type])):a[c.type]={},a[c.type][c.id]=d)}return s?a:e},le=function(e,r){if(!r.queryId)return e;var n=H({},e[r.queryId]);n.loading=!0,n.query=t.cloneDeep(r),t.isUndefined(n.errors)&&(n.errors=[]);var o=H({},e);return o[n.query.queryId]=n,o},ye=function(e,r,n){var o=e[r];if(o){var i=t.isArray(n.data)?n.data:[n.data],a=H({},o,{resultIds:i.map(function(e){return e?Ee(e):[]}),meta:n.meta,links:n.links,loading:!1});if(!t.isEqual(a,o)){var s=H({},e);return s[r]=a,s}}return e},he=function(e,t,r){var n;if(!t||!e[t])return e;var o=H({},e),i=H({},o[t]);return i.errors=[],i.loading=!1,r.errors&&(n=i.errors).push.apply(n,r.errors),o[t]=i,o},ve=function(e,t){var r=H({},e);return delete r[t],r},Ee=function(e){return{type:e.type,id:e.id}},Ae=function(e,r,n,o,i){t.isUndefined(i)&&(i=".");for(var a=e.split(i),s=r,u=0;u<a.length;u++){var p=t.find(o,{type:s.type});if(t.isUndefined(p))throw new Error("Definition not found");if(t.isUndefined(p.attributes)&&t.isUndefined(p.relationships))throw new Error("Attributes or Relationships must be provided");if("id"===a[u])return t.get(s,"id",null);if(p.attributes.hasOwnProperty(a[u]))return t.get(s,"attributes."+a[u],null);if(!p.relationships.hasOwnProperty(a[u]))throw new Error("Cannot find field in attributes or relationships");if(u===a.length-1)throw new Error("The last field in the filtering path cannot be a relation");var c=p.relationships[a[u]];if("hasMany"===c.relationType)throw new Error("Cannot filter past a hasMany relation");var d=t.get(s,"relationships."+a[u],null);if(!d||!d.data)return null;var f=[c.type,d.data.id];if(s=t.get(n,f),t.isUndefined(s))return null}},Ie=function(e,r,n,o,i){return t.filter(e,function(e){return!n.hasOwnProperty("params")||!n.params.hasOwnProperty("filtering")||n.params.filtering.every(function(n){var a,s;t.isUndefined(i)||(a=t.get(i,"pathSeparator"),s=t.get(i,"filteringOperators"));var u=Ae(n.path,e,r,o,a);if(!u)return!1;var p=t.find(s,{name:n.operator});if(p)return p.comparison(n.value,u);switch(n.operator=n.hasOwnProperty("operator")?n.operator:"iexact",n.operator){case"iexact":return t.isString(n.value)&&t.isString(u)?n.value.toLowerCase()===u.toLowerCase():n.value===u;case"exact":return n.value===u;case"contains":return t.includes(u,n.value);case"icontains":return t.includes(u.toLowerCase(),n.value.toLowerCase());case"in":return t.isArray(n.value)?t.includes(n.value,u):t.includes([n.value],u);case"gt":return n.value>u;case"gte":return n.value>=u;case"lt":return n.value<u;case"lte":return n.value<=u;case"startswith":return t.startsWith(u,n.value);case"istartswith":return t.startsWith(u.toLowerCase(),n.value.toLowerCase());case"endswith":return t.endsWith(u,n.value);case"iendswith":return t.endsWith(u.toLowerCase(),n.value.toLowerCase());default:return!0}})})},ge=function(e){return t.isEmpty(e)?"":"include="+e.join()},_e=function(e){return t.isEmpty(e)?"":"fields="+e.join()},Pe=function(e){return t.isEmpty(e)?"":e.map(function(e){return"filter"+(e.path?"["+e.path+"]":"")+(e.operator?"["+e.operator+"]":"")+"="+encodeURIComponent(e.value)}).join("&")},Se=function(e){return t.isEmpty(e)?"":"sort="+e.map(function(e){return(e.direction===$.ASC?"":"-")+e.api}).join(",")},Re=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e.filter(function(e){return""!==e});return 0!==r.length?"?"+r.join("&"):""},Oe=function(e,t){var r={query:{type:e.type}};return"POST"!==t&&"PATCH"!==t||(r.jsonApiData=H({data:{id:e.id,type:e.type,attributes:e.attributes,relationships:e.relationships}},e.meta?{meta:e.meta}:null)),"POST"===t&&e.hasTemporaryId&&delete r.jsonApiData.data.id,e.isMetaOnly&&delete r.jsonApiData.data,"PATCH"!==t&&"DELETE"!==t&&"POST"!==t||(r.query.id=e.id),r},Te=function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);var r=4294967295*Math.random()|0,n=4294967295*Math.random()|0,o=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return e[255&r]+e[r>>8&255]+e[r>>16&255]+e[r>>24&255]+"-"+e[255&n]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[63&o|128]+e[o>>8&255]+"-"+e[o>>16&255]+e[o>>24&255]+e[255&i]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]},me=function(e){return e.id+"@"+e.type},Ce=function(e,t){for(var r in e.queries)if(e.queries.hasOwnProperty(r)){var n=e.queries[r];if(n.resultIds)for(var o=0,i=n.resultIds;o<i.length;o++){var a=i[o];t[me(a)]=!0}}},qe=function(e,t){for(var r in e.data)if(e.data.hasOwnProperty(r)){var n=e.data[r];for(var o in n)if(n.hasOwnProperty(o)){var i=n[o];"IN_SYNC"!==i.state&&(t[me(i)]=!0)}}},we=function(e,t,r){var n;for(var o in r.relationships)if(r.relationships.hasOwnProperty(o)){var i=r.relationships[o].data;if(i)for(var a=i instanceof Array?i:[i],s=0,u=a;s<u.length;s++){var p=u[s],c=me(p);t[c]||(n=!0,t[c]=!0)}}return n},Le=function(e,t){for(;;){var r=!1;for(var n in e.data)if(e.data.hasOwnProperty(n)){var o=e.data[n];for(var i in o)if(o.hasOwnProperty(i)){var a=o[i];t[me(a)]&&(r=r||we(0,t,a))}}if(!r)break}},Ue=function(e,r){var n=!1,o=t.cloneDeep(e);for(var i in o.data)if(o.data.hasOwnProperty(i)){var a=o.data[i];for(var s in a)if(a.hasOwnProperty(s)){var u=a[s];r[me(u)]||(n=!0,delete a[s])}t.isEmpty(a)&&delete o.data[i]}return n?o:e},De=function(e){var t={};return Ce(e,t),qe(e,t),Le(e,t),Ue(e,t)},be=function(e){for(var t={},r={},n=0,o=e;n<o.length;n++){var i=o[n],a=i,s=me(a);t[s]=[],r[s]=i}for(var u=0,p=e;u<p.length;u++){var i=p[u];!function(e){var n=e;if(n.relationships){var o=me(n);Object.keys(n.relationships).forEach(function(e){var i=n.relationships[e].data;if(i)for(var a=i instanceof Array?i:[i],s=0,u=a;s<u.length;s++){var p=u[s],c=me(p);r[c]&&"CREATED"===r[c].state&&t[o].push(r[c])}})}}(i)}for(var c={pendingResources:e,cursor:e.length,sorted:new Array(e.length),dependencies:t,visited:[]},d=c.cursor;d--;)c.visited[d]||je(e[d],d,[],c);return c.sorted.reverse()},je=function(e,t,r,n){var o=me(e);if(r.indexOf(o)>=0)throw new Error("Cyclic dependency: "+o+" with "+JSON.stringify(r));if(!n.visited[t]){n.visited[t]=!0;for(var i=n.dependencies[o],a=r.concat(o),s=0,u=i;s<u.length;s++){var p=u[s];je(p,n.pendingResources.indexOf(p),a,n)}n.sorted[--n.cursor]=e}},Ne=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},xe=function(){function e(){}return e.prototype.getNgrxJsonApiStore$=function(){return function(e){return e.let(m())}},e.prototype.getStoreData$=function(){return function(e){return e.select("data")}},e.prototype.getStoreResourceOfType$=function(e){var t=this;return function(r){return r.let(t.getStoreData$()).map(function(t){return t?t[e]:void 0})}},e.prototype.getStoreQueries$=function(){return function(e){return e.select("queries")}},e.prototype.getResourceQuery$=function(e){return w(e)},e.prototype.getStoreResource$=function(e){return U(e)},e.prototype.getManyResults$=function(e,t){return b(e,t)},e.prototype.getOneResult$=function(e,t){return j(e,t)},e.prototype.getPersistedResource$=function(e){var t=this;return function(r){return r.let(t.getStoreResource$(e)).map(function(e){return e?e.persistedResource:void 0})}},e}(),ze=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Fe={API_POST_INIT:"[NgrxJsonApi] API_POST_INIT",API_POST_SUCCESS:"[NgrxJsonApi] API_POST_SUCCESS",API_POST_FAIL:"[NgrxJsonApi] API_POST_FAIL",API_GET_INIT:"[NgrxJsonApi] API_GET_INIT",API_GET_SUCCESS:"[NgrxJsonApi] API_GET_SUCCESS",API_GET_FAIL:"[NgrxJsonApi] API_GET_FAIL",API_PATCH_INIT:"[NgrxJsonApi] API_PATCH_INIT",API_PATCH_SUCCESS:"[NgrxJsonApi] API_PATCH_SUCCESS",API_PATCH_FAIL:"[NgrxJsonApi] API_PATCH_FAIL",API_DELETE_INIT:"[NgrxJsonApi] API_DELETE_INIT",API_DELETE_SUCCESS:"[NgrxJsonApi] API_DELETE_SUCCESS",API_DELETE_FAIL:"[NgrxJsonApi] API_DELETE_FAIL",API_APPLY_INIT:"[NgrxJsonApi] API_APPLY_INIT",API_APPLY_SUCCESS:"[NgrxJsonApi] API_APPLY_SUCCESS",API_APPLY_FAIL:"[NgrxJsonApi] API_APPLY_FAIL",API_ROLLBACK:"[NgrxJsonApi] API_ROLLBACK",API_QUERY_REFRESH:"[NgrxJsonApi] API_QUERY_REFRESH",LOCAL_QUERY_INIT:"[NgrxJsonApi] LOCAL_QUERY_INIT",LOCAL_QUERY_SUCCESS:"[NgrxJsonApi] LOCAL_QUERY_SUCCESS",LOCAL_QUERY_FAIL:"[NgrxJsonApi] LOCAL_QUERY_FAIL",DELETE_STORE_RESOURCE:"[NgrxJsonApi] DELETE_STORE_RESOURCE",PATCH_STORE_RESOURCE:"[NgrxJsonApi] PATCH_STORE_RESOURCE",NEW_STORE_RESOURCE:"[NgrxJsonApi] NEW_STORE_RESOURCE",POST_STORE_RESOURCE:"[NgrxJsonApi] POST_STORE_RESOURCE",MODIFY_STORE_RESOURCE_ERRORS:"[NgrxJsonApi] MODIFY_STORE_RESOURCE_ERRORS",REMOVE_QUERY:"[NgrxJsonApi] REMOVE_QUERY",COMPACT_STORE:"[NgrxJsonApi] COMPACT_STORE",CLEAR_STORE:"[NgrxJsonApi] CLEAR_STORE"},Qe=function(){function e(){}return e}(),Je=function(e){function t(t,r){var n=e.call(this)||this;return n.payload=t,n.zoneId=r,n.type=Fe.API_APPLY_INIT,n}return ze(t,e),t}(Qe),Ye=function(e){function t(t,r){var n=e.call(this)||this;return n.payload=t,n.zoneId=r,n.type=Fe.API_APPLY_SUCCESS,n}return ze(t,e),t}(Qe),Me=function(e){function t(t,r){var n=e.call(this)||this;return n.payload=t,n.zoneId=r,n.type=Fe.API_APPLY_FAIL,n}return ze(t,e),t}(Qe),$e=function(e){function t(t,r){var n=e.call(this)||this;return n.payload=t,n.zoneId=r,n.type=Fe.API_POST_INIT,n}return ze(t,e),t}(Qe),He=function(e){function t(t,r){var n=e.call(this)||this;return n.payload=t,n.zoneId=r,n.type=Fe.API_POST_SUCCESS,n}return ze(t,e),t}(Qe),Ge=function(e){function t(t,r){var n=e.call(this)||this;return n.payload=t,n.zoneId=r,n.type=Fe.API_POST_FAIL,n}return ze(t,e),t}(Qe),ke=function(e){function t(t,r){var n=e.call(this)||this;return n.payload=t,n.zoneId=r,n.type=Fe.API_DELETE_INIT,n}return ze(t,e),t}(Qe),We=function(e){function t(t,r){var n=e.call(this)||this;return n.payload=t,n.zoneId=r,n.type=Fe.API_DELETE_SUCCESS,n}return ze(t,e),t}(Qe),Be=function(e){function t(t,r){var n=e.call(this)||this;return n.payload=t,n.zoneId=r,n.type=Fe.API_DELETE_FAIL,n}return ze(t,e),t}(Qe),Ve=function(e){function t(t,r){var n=e.call(this)||this;return n.payload=t,n.zoneId=r,n.type=Fe.API_GET_INIT,n}return ze(t,e),t}(Qe),Ze=function(e){function t(t,r){var n=e.call(this)||this;return n.payload=t,n.zoneId=r,n.type=Fe.API_GET_SUCCESS,n}return ze(t,e),t}(Qe),Ke=function(e){function t(t,r){var n=e.call(this)||this;return n.payload=t,n.zoneId=r,n.type=Fe.API_GET_FAIL,n}return ze(t,e),t}(Qe),Xe=function(e){function t(t,r){var n=e.call(this)||this;return n.payload=t,n.zoneId=r,n.type=Fe.API_ROLLBACK,n}return ze(t,e),t}(Qe),et=function(e){function t(t,r){var n=e.call(this)||this;return n.payload=t,n.zoneId=r,n.type=Fe.API_PATCH_INIT,n}return ze(t,e),t}(Qe),tt=function(e){function t(t,r){var n=e.call(this)||this;return n.payload=t,n.zoneId=r,n.type=Fe.API_PATCH_SUCCESS,n}return ze(t,e),t}(Qe),rt=function(e){function t(t,r){var n=e.call(this)||this;return n.payload=t,n.zoneId=r,n.type=Fe.API_PATCH_FAIL,n}return ze(t,e),t}(Qe),nt=function(e){function t(t,r){var n=e.call(this)||this;return n.payload=t,n.zoneId=r,n.type=Fe.DELETE_STORE_RESOURCE,n}return ze(t,e),t}(Qe),ot=function(e){function t(t,r){var n=e.call(this)||this;return n.payload=t,n.zoneId=r,n.type=Fe.PATCH_STORE_RESOURCE,n}return ze(t,e),t}(Qe),it=function(e){function t(t,r){var n=e.call(this)||this;return n.payload=t,n.zoneId=r,n.type=Fe.NEW_STORE_RESOURCE,n}return ze(t,e),t}(Qe),at=function(e){function t(t,r){var n=e.call(this)||this;return n.payload=t,n.zoneId=r,n.type=Fe.POST_STORE_RESOURCE,n}return ze(t,e),t}(Qe),st=function(e){function t(t,r){var n=e.call(this)||this;return n.payload=t,n.zoneId=r,n.type=Fe.REMOVE_QUERY,n}return ze(t,e),t}(Qe),ut=function(e){function t(t,r){var n=e.call(this)||this;return n.payload=t,n.zoneId=r,n.type=Fe.LOCAL_QUERY_INIT,n}return ze(t,e),t}(Qe),pt=function(e){function t(t,r){var n=e.call(this)||this;return n.payload=t,n.zoneId=r,n.type=Fe.LOCAL_QUERY_SUCCESS,n}return ze(t,e),t}(Qe),ct=function(e){function t(t,r){var n=e.call(this)||this;return n.payload=t,n.zoneId=r,n.type=Fe.LOCAL_QUERY_FAIL,n}return ze(t,e),t}(Qe),dt=function(e){function t(t){var r=e.call(this)||this;return r.zoneId=t,r.type=Fe.COMPACT_STORE,r}return ze(t,e),t}(Qe),ft=function(e){function t(t){var r=e.call(this)||this;return r.zoneId=t,r.type=Fe.CLEAR_STORE,r}return ze(t,e),t}(Qe),lt=function(e){function t(t,r){var n=e.call(this)||this;if(n.payload=t,n.zoneId=r,n.type=Fe.API_QUERY_REFRESH,!t)throw new Error("no query id provided for ApiQueryRefreshAction");return n}return ze(t,e),t}(Qe),yt=function(e){function t(t,r){var n=e.call(this)||this;return n.payload=t,n.zoneId=r,n.type=Fe.MODIFY_STORE_RESOURCE_ERRORS,n}return ze(t,e),t}(Qe),ht=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),vt=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},Et=function(){function e(e,t){this.zoneId=e,this.store=t}return e.prototype.putQuery=function(e){var r=e.query,n=!!t.isUndefined(e.fromServer)||e.fromServer;if(!r.queryId)throw new Error("to query must have a queryId");n?this.store.dispatch(new Ve(r,this.zoneId)):this.store.dispatch(new ut(r,this.zoneId))},e.prototype.refreshQuery=function(e){this.store.dispatch(new lt(e,this.zoneId))},e.prototype.removeQuery=function(e){this.store.dispatch(new st(e,this.zoneId))},e.prototype.selectManyResults=function(e,t){return void 0===t&&(t=!1),this.store.let(C(this.zoneId)).let(b(e,t))},e.prototype.selectOneResults=function(e,t){return void 0===t&&(t=!1),this.store.let(C(this.zoneId)).let(j(e,t))},e.prototype.selectStoreResource=function(e){return this.store.let(C(this.zoneId)).let(U(e))},e.prototype.selectStoreResources=function(e){return this.store.let(C(this.zoneId)).let(D(e))},e.prototype.patchResource=function(e){var r=e.resource;!t.isUndefined(e.toRemote)&&e.toRemote?this.store.dispatch(new et(r,this.zoneId)):this.store.dispatch(new ot(r,this.zoneId))},e.prototype.newResource=function(e){var t=e.resource;this.store.dispatch(new it(t,this.zoneId))},e.prototype.postResource=function(e){var r=e.resource;!t.isUndefined(e.toRemote)&&e.toRemote?this.store.dispatch(new $e(r,this.zoneId)):this.store.dispatch(new at(r,this.zoneId))},e.prototype.deleteResource=function(e){var r=e.resourceId;!t.isUndefined(e.toRemote)&&e.toRemote?this.store.dispatch(new ke(r,this.zoneId)):this.store.dispatch(new nt(r,this.zoneId))},e.prototype.apply=function(){this.store.dispatch(new Je({},this.zoneId))},e.prototype.clear=function(){this.store.dispatch(new ft(this.zoneId))},e.prototype.compact=function(){this.store.dispatch(new dt(this.zoneId))},e.prototype.addResourceErrors=function(e,t){this.store.dispatch(new yt({resourceId:e,errors:t,modificationType:"ADD"},this.zoneId))},e.prototype.removeResourceErrors=function(e,t){this.store.dispatch(new yt({resourceId:e,errors:t,modificationType:"REMOVE"},this.zoneId))},e.prototype.setResourceErrors=function(e,t){this.store.dispatch(new yt({resourceId:e,errors:t,modificationType:"SET"},this.zoneId))},e}(),At=function(e){function r(t,r){var n=e.call(this,M,t)||this;return n.config=r,n.test=!0,n}return ht(r,e),r.prototype.getDefaultZone=function(){return this},r.prototype.getZone=function(e){return new Et(e,this.store)},r.prototype.findOne=function(e){return this.findInternal(e,!1)},r.prototype.findMany=function(e){return this.findInternal(e,!0)},Object.defineProperty(r.prototype,"storeSnapshot",{get:function(){var e=this;if(!this._storeSnapshot&&(this.store.let(m()).subscribe(function(t){return e._storeSnapshot=t}),!this._storeSnapshot))throw new Error("failed to initialize store snapshot");return this._storeSnapshot},enumerable:!0,configurable:!0}),r.prototype.findInternal=function(e,r){var n,o=this,i=e.query,a=!!t.isUndefined(e.fromServer)||e.fromServer,s=!t.isUndefined(e.denormalise)&&e.denormalise;n=i.queryId?i:vt({},i,{queryId:this.uuid()}),this.putQuery({query:n,fromServer:a});var u;return u=r?this.selectManyResults(n.queryId,s):this.selectOneResults(n.queryId,s),u.finally(function(){return o.removeQuery(n.queryId)})},r.prototype.uuid=function(){return Te()},r.prototype.getPersistedResourceSnapshot=function(e){var t=this.storeSnapshot;return t.data[e.type]&&t.data[e.type][e.id]?t.data[e.type][e.id].persistedResource:null},r.prototype.getResourceSnapshot=function(e){var t=this.storeSnapshot;return t.data[e.type]&&t.data[e.type][e.id]?t.data[e.type][e.id]:null},r.prototype.denormaliseResource=function(e,r){return void 0===r&&(r=this.zoneId),e.combineLatest(this.store.let(C(r)).map(function(e){return e.data}),function(e,r){return t.isArray(e)?k(e,r):W(e,r)})},r.prototype.getDenormalisedPath=function(e,r){var n=t.get(this.config,"filteringConfig.pathSeparator");return Z(e,r,this.config.resourceDefinitions,n)},r.prototype.getDenormalisedValue=function(e,r){var n=t.get(this.config,"filteringConfig.pathSeparator");return K(e,r,this.config.resourceDefinitions,n)},r}(Et),It=function(){function e(e){this.service=e}return e.prototype.transform=function(e,t){return void 0===t&&(t=M),this.service.getZone(t).selectStoreResource(e)},e.decorators=[{type:E.Pipe,args:[{name:"jaSelectStoreResource"}]}],e.ctorParameters=function(){return[{type:At}]},e}(),gt=function(){function e(e){this.service=e}return e.prototype.transform=function(e,t){return void 0===t&&(t=M),this.service.getZone(t).selectStoreResources(e)},e.decorators=[{type:E.Pipe,args:[{name:"jaSelectStoreResources"}]}],e.ctorParameters=function(){return[{type:At}]},e}(),_t=function(){function e(e){this.service=e}return e.prototype.transform=function(e,t){return void 0===t&&(t=M),this.service.denormaliseResource(e,t)},e.decorators=[{type:E.Pipe,args:[{name:"denormaliseStoreResource"}]}],e.ctorParameters=function(){return[{type:At}]},e}(),Pt=function(){function e(e){this.service=e}return e.prototype.transform=function(e,t){return this.service.getDenormalisedValue(e,t)},e.decorators=[{type:E.Pipe,args:[{name:"getDenormalisedValue"}]}],e.ctorParameters=function(){return[{type:At}]},e}(),St=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},Rt=function(e,t){var r={}
;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&(r[n[o]]=e[n[o]]);return r},Ot=function(){function e(e,r){if(this.http=e,this.config=r,this.headers=new A.HttpHeaders({"Content-Type":"application/vnd.api+json",Accept:"application/vnd.api+json"}),this.definitions=this.config.resourceDefinitions,this.config.requestHeaders)for(var n=0,o=t.keys(this.config.requestHeaders);n<o.length;n++){var i=o[n],a=this.config.requestHeaders[i];this.headers=this.headers.set(i,a)}}return e.prototype.urlBuilder=function(e,t){switch(t){case"GET":if(e.type&&e.id)return this.resourceUrlFor(e.type,e.id);if(e.type)return this.collectionUrlFor(e.type);case"DELETE":if(e.type&&e.id)return this.resourceUrlFor(e.type,e.id);case"PATCH":if(e.type&&e.id)return this.resourceUrlFor(e.type,e.id);case"POST":return this.collectionUrlFor(e.type)}},e.prototype.collectionPathFor=function(e){var r=t.find(this.definitions,{type:e});return r?""+r.collectionPath:e},e.prototype.collectionUrlFor=function(e){var t=this.collectionPathFor(e);return this.config.apiUrl+"/"+t},e.prototype.resourcePathFor=function(e,t){return this.collectionPathFor(e)+"/"+encodeURIComponent(t)},e.prototype.resourceUrlFor=function(e,t){var r=this.resourcePathFor(e,t);return this.config.apiUrl+"/"+r},e.prototype.find=function(e){var r=ge,n=Pe,o=_e,i=Se,a=Re;if(this.config.hasOwnProperty("urlBuilder")){var s=this.config.urlBuilder;s.generateIncludedQueryParams&&(r=s.generateIncludedQueryParams),s.generateFilteringQueryParams&&(n=s.generateFilteringQueryParams),s.generateFieldsQueryParams&&(o=s.generateFieldsQueryParams),s.generateSortingQueryParams&&(i=s.generateSortingQueryParams),s.generateQueryParams&&(a=s.generateQueryParams)}var u="",p="",c="",d="",f="",l="",y="",h="";if(void 0===typeof e)return I.Observable.throw("Query not found");e.hasOwnProperty("params")&&!t.isEmpty(e.params)&&(t.hasIn(e.params,"include")&&(p=r(e.params.include)),t.hasIn(e.params,"filtering")&&(c=n(e.params.filtering)),t.hasIn(e.params,"sorting")&&(d=i(e.params.sorting)),t.hasIn(e.params,"fields")&&(f=o(e.params.fields)),t.hasIn(e.params,"limit")&&(y="page[limit]="+e.params.limit),t.hasIn(e.params,"offset")&&(l="page[offset]="+e.params.offset),t.hasIn(e.params,"page")&&(h=t.keys(e.params.page).map(function(t){return"page["+t+"]="+e.params.page[t]}).join("&"))),u=a(p,c,d,f,l,y,h);var v={method:"GET",url:this.urlBuilder(e,"GET")+u};return this.request(v)},e.prototype.create=function(e,t){if(void 0===typeof e)return I.Observable.throw("Query not found");if(void 0===typeof t)return I.Observable.throw("Data not found");var r={method:"POST",url:this.urlBuilder(e,"POST"),body:JSON.stringify(t)};return this.request(r)},e.prototype.update=function(e,t){if(void 0===typeof e)return I.Observable.throw("Query not found");if(void 0===typeof t)return I.Observable.throw("Data not found");var r={method:"PATCH",url:this.urlBuilder(e,"PATCH"),body:JSON.stringify(t)};return this.request(r)},e.prototype.delete=function(e){if(void 0===typeof e)return I.Observable.throw("Query not found");var t={method:"DELETE",url:this.urlBuilder(e,"DELETE")};return this.request(t)},e.prototype.request=function(e){var t=St({},e,{headers:this.headers,observe:"response",withCredentials:this.config.requestWithCredentials});if("GET"===e.method){var r=(t.method,t.url),n=Rt(t,["method","url"]);return this.http.get(r,n)}if("POST"===e.method){var r=(t.method,t.url),o=t.body,n=Rt(t,["method","url","body"]);return this.http.post(r,o,n)}if("PATCH"===e.method){var r=(t.method,t.url),o=t.body,n=Rt(t,["method","url","body"]);return this.http.patch(r,o,n)}if("DELETE"===e.method){var r=(t.method,t.url),n=Rt(t,["method","url"]);return this.http.delete(r,n)}},e}(),Tt=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},mt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ct=function(){function e(e,r,n){var o=this;this.actions$=e,this.jsonApi=r,this.store=n,this.createResource$=this.actions$.pipe(g.ofType(Fe.API_POST_INIT),y.mergeMap(function(e){var t=o.generatePayload(e.payload,"POST");return o.jsonApi.create(t.query,t.jsonApiData).pipe(y.map(function(r){return new He({jsonApiData:r.body,query:t.query},e.zoneId)}),y.catchError(function(r){return _.of(new Ge(o.toErrorPayload(t.query,r),e.zoneId))}))})),this.updateResource$=this.actions$.pipe(g.ofType(Fe.API_PATCH_INIT),y.mergeMap(function(e){var t=o.generatePayload(e.payload,"PATCH");return o.jsonApi.update(t.query,t.jsonApiData).pipe(y.map(function(r){return new tt({jsonApiData:r.body,query:t.query},e.zoneId)}),y.catchError(function(r){return _.of(new rt(o.toErrorPayload(t.query,r),e.zoneId))}))})),this.readResource$=this.actions$.pipe(g.ofType(Fe.API_GET_INIT),y.mergeMap(function(e){var t=e.payload;return o.jsonApi.find(t).pipe(y.map(function(e){return e.body}),y.map(function(r){return new Ze({jsonApiData:r,query:t},e.zoneId)}),y.catchError(function(r){return _.of(new Ke(o.toErrorPayload(t,r),e.zoneId))}))})),this.queryStore$=this.actions$.pipe(g.ofType(Fe.LOCAL_QUERY_INIT),y.mergeMap(function(e){var t=e.payload;return o.store.let(C(e.zoneId)).let(o.executeLocalQuery(t)).pipe(y.map(function(r){return new pt({jsonApiData:{data:r},query:t},e.zoneId)}),y.catchError(function(r){return _.of(new ct(o.toErrorPayload(t,r),e.zoneId))}),y.takeUntil(o.localQueryInitEventFor(t)),y.takeUntil(o.removeQueryEventFor(t)))})),this.deleteResource$=this.actions$.pipe(g.ofType(Fe.API_DELETE_INIT),y.mergeMap(function(e){var t=o.generatePayload(e.payload,"DELETE");return o.jsonApi.delete(t.query).pipe(y.map(function(e){return e.body}),y.map(function(r){return new We({jsonApiData:r,query:t.query},e.zoneId)}),y.catchError(function(r){return _.of(new Be(o.toErrorPayload(t.query,r),e.zoneId))}))})),this.triggerReadOnQueryRefresh$=this.actions$.pipe(g.ofType(Fe.API_QUERY_REFRESH),y.withLatestFrom(this.store,function(e,t){var r=e.payload,n=q(t,e.zoneId),o=n.queries[r].query;return new Ve(o,e.zoneId)})),this.refreshQueriesOnDelete$=this.actions$.pipe(g.ofType(Fe.API_DELETE_SUCCESS),y.withLatestFrom(this.store,function(e,r){var n={id:e.payload.query.id,type:e.payload.query.type};if(!n.id||!n.type)throw new Error("API_DELETE_SUCCESS did not carry resource id and type information");var o=q(r,e.zoneId),i=[];for(var a in o.queries)if(o.queries.hasOwnProperty(a)){var s=o.queries[a];if(s.resultIds){var u=-1!==t.findIndex(s.resultIds,function(e){return t.isEqual(n,e)}),p=s.query.id===n.id&&s.query.type===n.type;if(p&&(u||t.isEmpty(s.errors)))throw new Error("store is in invalid state, queries for deleted resource should have been emptied and marked with 404 error");u&&i.push(new lt(a,e.zoneId))}}return i}),y.flatMap(function(e){return _.of.apply(void 0,e)})),this.applyResources$=this.actions$.pipe(g.ofType(Fe.API_APPLY_INIT),y.filter(function(){return!1!==o.jsonApi.config.applyEnabled}),y.withLatestFrom(this.store,function(e,t){var r=q(t,e.zoneId),n=e.payload,i=O(r.data,n.ids,n.include);if(0===i.length)return _.of(new Ye([],e.zoneId));for(var a=be(i),s=[],u=0,p=a;u<p.length;u++){var c=p[u];if("CREATED"===c.state)s.push(o.handlePendingCreate(c,e.zoneId));else if("UPDATED"===c.state)s.push(o.handlePendingUpdate(c,e.zoneId));else{if("DELETED"!==c.state)throw new Error("unknown state "+c.state);s.push(o.handlePendingDelete(c,e.zoneId))}}return _.of.apply(void 0,s).concatAll().pipe(y.toArray(),y.map(function(t){return o.toApplyAction(t,e.zoneId)}))}),y.flatMap(function(e){return e})),this.config=this.jsonApi.config}return e.prototype.localQueryInitEventFor=function(e){return this.actions$.pipe(g.ofType(Fe.LOCAL_QUERY_INIT),y.map(function(e){return e}),y.filter(function(t){return e.queryId==t.payload.queryId}))},e.prototype.removeQueryEventFor=function(e){return this.actions$.pipe(g.ofType(Fe.REMOVE_QUERY),y.map(function(e){return e}),y.filter(function(t){return e.queryId==t.payload}))},e.prototype.executeLocalQuery=function(e){var t=this;return function(r){var n;return e.type?(n=e.type&&e.id?r.let(U({type:e.type,id:e.id})):r.let(L(e.type)).pipe(y.combineLatest(r.map(function(e){return e.data}),function(r,n){return Ie(r,n,e,t.config.resourceDefinitions,t.config.filteringConfig)})),n.distinctUntilChanged()):r.map(function(){return I.Observable.throw("Unknown query")})}},e.prototype.handlePendingCreate=function(e,t){var r=this,n=this.generatePayload(e,"POST");return this.jsonApi.create(n.query,n.jsonApiData).pipe(y.map(function(e){return new He({jsonApiData:e.body,query:n.query},t)}),y.catchError(function(e){return _.of(new Ge(r.toErrorPayload(n.query,e),t))}))},e.prototype.handlePendingUpdate=function(e,t){var r=this,n=this.generatePayload(e,"PATCH");return this.jsonApi.update(n.query,n.jsonApiData).pipe(y.map(function(e){return new tt({jsonApiData:e.body,query:n.query},t)}),y.catchError(function(e){return _.of(new rt(r.toErrorPayload(n.query,e),t))}))},e.prototype.handlePendingDelete=function(e,t){var r=this,n=this.generatePayload(e,"DELETE");return this.jsonApi.delete(n.query).pipe(y.map(function(e){return new We({jsonApiData:e.body,query:n.query},t)}),y.catchError(function(e){return _.of(new Be(r.toErrorPayload(n.query,e),t))}))},e.prototype.ngOnDestroy=function(){},e.prototype.toApplyAction=function(e,t){for(var r=0,n=e;r<n.length;r++){var o=n[r];if(o.type===Fe.API_POST_FAIL||o.type===Fe.API_PATCH_FAIL||o.type===Fe.API_DELETE_FAIL)return new Me(e,t)}return new Ye(e,t)},e.prototype.toErrorPayload=function(e,t){var r=null;t&&t.headers&&(r=t.headers.get("Content-Type"));var n=null;if(null!=r&&r.startsWith("application/vnd.api+json")&&(n=t),n&&n.error&&n.error.errors&&n.error.errors.length>0)return{query:e,jsonApiData:n.error};var o=[],i={status:String(t.status),code:t.statusText};return o.push(i),{query:e,jsonApiData:{errors:o}}},e.prototype.generatePayload=function(e,t){return Oe(e,t)},e.decorators=[{type:E.Injectable}],e.ctorParameters=function(){return[{type:g.Actions},{type:Ot},{type:h.Store}]},Tt([g.Effect(),mt("design:type",I.Observable)],e.prototype,"createResource$",void 0),Tt([g.Effect(),mt("design:type",I.Observable)],e.prototype,"updateResource$",void 0),Tt([g.Effect(),mt("design:type",I.Observable)],e.prototype,"readResource$",void 0),Tt([g.Effect(),mt("design:type",Object)],e.prototype,"queryStore$",void 0),Tt([g.Effect(),mt("design:type",Object)],e.prototype,"deleteResource$",void 0),Tt([g.Effect(),mt("design:type",Object)],e.prototype,"triggerReadOnQueryRefresh$",void 0),Tt([g.Effect(),mt("design:type",I.Observable)],e.prototype,"refreshQueriesOnDelete$",void 0),Tt([g.Effect(),mt("design:type",I.Observable)],e.prototype,"applyResources$",void 0),e}(),qt=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},wt={isCreating:0,isReading:0,isUpdating:0,isDeleting:0,isApplying:0,data:{},queries:{}},Lt={zones:{}},Ut=x,Dt=new E.InjectionToken("NGRX_JSON_API_CONFIG"),bt=function(){function e(){}return e.configure=function(t){return{ngModule:e,providers:Y(t)}},e.decorators=[{type:E.NgModule,args:[{declarations:[_t,Pt,It,gt],imports:[g.EffectsModule.forFeature([Ct]),h.StoreModule.forFeature("NgrxJsonApi",Ut,{})],exports:[_t,Pt,It,gt]}]}],e}();e.SelectStoreResourcePipe=It,e.SelectStoreResourcesPipe=gt,e.DenormaliseStoreResourcePipe=_t,e.GetDenormalisedValuePipe=Pt,e.NgrxJsonApiService=At,e.NgrxJsonApiZoneService=Et,e.NgrxJsonApiModule=bt,e.NGRX_JSON_API_CONFIG=Dt,e.uuid=Te,e.NGRX_JSON_API_DEFAULT_ZONE=M,e.Direction=$,e.NgrxJsonApiActionTypes=Fe,e.NgrxJsonApiAction=Qe,e.ApiApplyInitAction=Je,e.ApiApplySuccessAction=Ye,e.ApiApplyFailAction=Me,e.ApiPostInitAction=$e,e.ApiPostSuccessAction=He,e.ApiPostFailAction=Ge,e.ApiDeleteInitAction=ke,e.ApiDeleteSuccessAction=We,e.ApiDeleteFailAction=Be,e.ApiGetInitAction=Ve,e.ApiGetSuccessAction=Ze,e.ApiGetFailAction=Ke,e.ApiRollbackAction=Xe,e.ApiPatchInitAction=et,e.ApiPatchSuccessAction=tt,e.ApiPatchFailAction=rt,e.DeleteStoreResourceAction=nt,e.PatchStoreResourceAction=ot,e.NewStoreResourceAction=it,e.PostStoreResourceAction=at,e.RemoveQueryAction=st,e.LocalQueryInitAction=ut,e.LocalQuerySuccessAction=pt,e.LocalQueryFailAction=ct,e.CompactStoreAction=dt,e.ClearStoreAction=ft,e.ApiQueryRefreshAction=lt,e.ModifyStoreResourceErrorsAction=yt,e.selectNgrxJson=T,e.selectNgrxJsonApiDefaultZone=m,e.selectNgrxJsonApiZone=C,e.getNgrxJsonApiZone=q,e.selectStoreQuery=w,e.selectStoreResourcesOfType=L,e.selectStoreResource=U,e.selectStoreResources=D,e.selectManyQueryResult=b,e.selectOneQueryResult=j,e.getNgrxJsonApiStore=N,e.NgrxJsonApiSelectors=xe,e.ɵf=Ot,e.ɵe=Ct,e.ɵa=F,e.ɵd=Y,e.ɵb=Q,e.ɵc=J,e.ɵg=x,e.ɵh=Ut,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=./dist/bundles/ngrx-json-api.umd.min.js.map